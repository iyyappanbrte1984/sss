<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Endangered Ocean Species ‚Äì Smart Gallery</title>
  <meta name="viewport"content="width=device-width,initial-scale=1.0">

  <style>
    :root{
      --deep-blue:#020b1b;
      --card-bg:#ffffff;
      --accent-cr:#e63946;
      --accent-en:#f77f00;
      --accent-vu:#f9c74f;
      --text-dark:#1d3557;
      --text-muted:#6c757d;
      --ai-purple:#7b2ff2;
    }
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#032a4a,#020b1b 42%,#000 80%);
      color:#f8f9fa;
    }
    .page-shell{
      max-width:1180px;
      margin:0 auto;
      padding:20px 16px 48px;
    }
    #endangered-gallery{
      margin-top:10px;
      padding:22px 18px 28px;
      border-radius:18px;
      background:linear-gradient(135deg,#05152b,#030a1b 50%,#0b2347);
      box-shadow:0 18px 45px rgba(0,0,0,0.45);
      border:1px solid rgba(255,255,255,0.05);
    }
    .gallery-heading{
      font-size:24px;
      margin:0 0 4px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .gallery-subtitle{
      font-size:13px;
      color:#d3dde9;
      max-width:640px;
      margin-bottom:12px;
    }
    .gallery-subtitle span{
      color:#ffce6b;
      font-weight:600;
    }
    .gallery-toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .legend-chips{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size:11px;
    }
    .legend-chip{
      border-radius:999px;
      padding:3px 8px;
      border:1px solid rgba(255,255,255,0.14);
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:rgba(0,0,0,0.25);
    }
    .legend-dot{
      width:9px;
      height:9px;
      border-radius:50%;
    }
    .legend-dot.cr{background:linear-gradient(90deg,#e63946,#f77f00);}
    .legend-dot.en{background:linear-gradient(90deg,#f77f00,#fcbf49);}
    .legend-dot.vu{background:linear-gradient(90deg,#f9c74f,#90be6d);}
    .view-toggle{
      font-size:11px;
      display:flex;
      gap:6px;
      align-items:center;
      color:#cfd7e4;
    }
    .view-toggle button{
      border-radius:999px;
      border:0;
      padding:4px 9px;
      background:rgba(255,255,255,0.08);
      color:#e9eef8;
      cursor:pointer;
      font-size:11px;
    }
    .view-toggle button.active{
      background:linear-gradient(90deg,#4cc9f0,#f72585);
    }

    .gallery-main{
      display:grid;
      grid-template-columns:minmax(0,2fr) minmax(0,1.2fr);
      gap:22px;
      margin-top:6px;
    }
    @media(max-width:900px){
      .gallery-main{
        grid-template-columns:1fr;
      }
    }

    .gallery-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:18px;
    }
    .species-card{
      background:var(--card-bg);
      color:var(--text-dark);
      border-radius:18px;
      overflow:hidden;
      position:relative;
      box-shadow:0 14px 34px rgba(1,17,40,0.18);
      display:flex;
      flex-direction:column;
      min-height:340px;
      transform:translateY(6px);
      opacity:0;
      animation:card-in 0.5s ease forwards;
    }
    .species-card:nth-child(1){animation-delay:0.05s;}
    .species-card:nth-child(2){animation-delay:0.09s;}
    .species-card:nth-child(3){animation-delay:0.13s;}
    .species-card:nth-child(4){animation-delay:0.17s;}
    @keyframes card-in{
      to{transform:translateY(0);opacity:1;}
    }
    .species-photo-wrap{
      position:relative;
      height:180px;
      overflow:hidden;
    }
    .species-photo{
      width:100%;
      height:100%;
      object-fit:cover;
      transition:transform 0.6s ease;
    }
    .species-card:hover .species-photo{
      transform:scale(1.06);
    }
    .status-badge{
      position:absolute;
      top:12px;
      left:12px;
      padding:4px 10px;
      border-radius:999px;
      font-size:11px;
      font-weight:700;
      color:#fff;
      box-shadow:0 4px 10px rgba(0,0,0,0.35);
    }
    .species-card.status-cr .status-badge{
      background:linear-gradient(90deg,#e63946,#f77f00);
    }
    .species-card.status-en .status-badge{
      background:linear-gradient(90deg,#f77f00,#f9c74f);
    }
    .species-card.status-vu .status-badge{
      background:linear-gradient(90deg,#f9c74f,#90be6d);
    }
    .iucn-pill{
      position:absolute;
      top:12px;
      right:12px;
      font-size:10px;
      padding:3px 7px;
      border-radius:999px;
      background:rgba(3,4,15,0.78);
      color:#f1f3f8;
      border:1px solid rgba(255,255,255,0.18);
    }
    .species-body{
      padding:10px 13px 12px;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .common-name{
      font-size:18px;
      font-weight:700;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .sci-name{
      font-size:12px;
      font-style:italic;
      color:#4b5563;
    }
    .pop-count{
      font-size:11px;
      color:#495057;
    }
    .bio-text{
      font-size:12px;
      line-height:1.45;
      margin-top:4px;
      color:#374151;
    }
    .threats{
      list-style:none;
      margin:6px 0 0;
      padding:0;
      font-size:11px;
      color:#6b7280;
    }
    .region-highlight{
      margin-top:6px;
      font-size:11px;
      color:#1f2933;
      display:flex;
      align-items:center;
      gap:4px;
    }
    .region-highlight span{
      font-size:12px;
    }
    .ai-speech{
      margin-top:7px;
      font-size:11px;
      font-style:italic;
      color:var(--ai-purple);
      background:rgba(123,47,242,0.06);
      border-radius:10px;
      padding:7px 10px;
      border:1px dashed rgba(123,47,242,0.45);
      position:relative;
      overflow:hidden;
    }
    .ai-speech::before{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(120deg,rgba(123,47,242,0.25),rgba(123,47,242,0),rgba(123,47,242,0.25));
      opacity:0;
      transition:opacity .3s;
    }
    .species-card.speak .ai-speech::before{
      opacity:1;
    }
    .ai-speech span{
      font-size:15px;
      color:#a855f7;
    }
    .card-footer-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:6px;
      font-size:11px;
      color:#6b7280;
    }
    .ask-ai-link{
      color:var(--ai-purple);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
      font-weight:600;
    }
    .ask-ai-link:hover{
      text-decoration:underline;
    }

    /* AI panel on right side */
    .ai-panel{
      border-radius:16px;
      background:radial-gradient(circle at top,#182544,#050818 58%);
      padding:14px 14px 16px;
      border:1px solid rgba(255,255,255,0.08);
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      overflow:hidden;
    }
    .ai-panel::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 10% 0%,rgba(58,134,255,0.6),transparent 55%),
                 radial-gradient(circle at 90% 100%,rgba(250,82,160,0.55),transparent 65%);
      opacity:0.22;
      pointer-events:none;
    }
    .ai-panel-header{
      position:relative;
      z-index:1;
    }
    .ai-title-row{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .ai-orb{
      width:22px;
      height:22px;
      border-radius:50%;
      background:conic-gradient(from 0deg,#4cc9f0,#f72585,#4cc9f0);
      box-shadow:0 0 15px rgba(80,220,255,0.78);
      animation:spin 3s linear infinite;
    }
    @keyframes spin{
      to{transform:rotate(360deg);}
    }
    .ai-title{
      font-size:13px;
      font-weight:700;
      letter-spacing:0.02em;
    }
    .ai-subtitle{
      font-size:11px;
      color:#cbd5f1;
      margin-top:2px;
    }
    .ai-badge{
      position:absolute;
      top:0;
      right:0;
      padding:3px 8px;
      border-radius:999px;
      font-size:10px;
      background:rgba(0,0,0,0.50);
      color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.6);
      display:flex;
      align-items:center;
      gap:5px;
    }
    .ai-badge span{
      font-size:11px;
    }

    .ai-display{
      position:relative;
      z-index:1;
      border-radius:12px;
      background:rgba(3,5,18,0.8);
      border:1px solid rgba(148,163,184,0.35);
      padding:10px 11px;
      min-height:120px;
      font-size:12px;
      color:#e5e7eb;
      overflow:auto;
    }
    .ai-placeholder{
      text-align:center;
      font-size:12px;
      color:#a5b4fc;
      opacity:0.9;
      padding:16px 4px;
    }

    .ai-loading{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      padding:14px 0;
    }
    .ai-loading-spinner{
      width:30px;
      height:30px;
      border-radius:50%;
      border:3px solid rgba(148,163,184,0.38);
      border-top-color:#4cc9f0;
      border-right-color:#f72585;
      animation:spin 0.9s linear infinite;
    }
    .ai-loading-label{
      font-size:11px;
      color:#e5e7eb;
      text-align:center;
    }
    .ai-answer-block{
      animation:fade-up .45s ease-out;
    }
    @keyframes fade-up{
      from{opacity:0;transform:translateY(10px);}
      to{opacity:1;transform:translateY(0);}
    }
    .ai-answer-title{
      font-size:12px;
      font-weight:600;
      margin-bottom:4px;
      color:#e0e7ff;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .ai-answer-title span{
      font-size:13px;
    }
    .ai-metrics{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(90px,1fr));
      gap:6px;
      margin:4px 0 8px;
    }
    .ai-metric-card{
      background:rgba(15,23,42,0.95);
      border-radius:8px;
      padding:5px 7px;
      border:1px solid rgba(99,102,241,0.65);
    }
    .ai-metric-main{
      font-size:13px;
      font-weight:700;
      color:#f9fafb;
    }
    .ai-metric-label{
      font-size:11px;
      color:#a5b4fc;
    }
    .ai-body-text{
      font-size:11px;
      line-height:1.55;
      color:#e5e7eb;
      margin-bottom:5px;
    }
    .ai-footer-text{
      font-size:10px;
      color:#9ca3af;
      margin-top:4px;
    }
    .ai-actions-row{
      position:relative;
      z-index:1;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:6px;
      font-size:11px;
      color:#c7d2fe;
    }
    .ai-small-note{
      opacity:0.8;
    }
    .ai-refresh-btn{
      border-radius:999px;
      border:0;
      padding:5px 11px;
      font-size:11px;
      font-weight:600;
      background:linear-gradient(90deg,#4cc9f0,#f72585);
      color:#fff;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    .ai-refresh-btn:hover{
      filter:brightness(1.06);
    }
    .ai-refresh-btn span{
      font-size:12px;
    }
  </style>
</head>
<body>
<div class="page-shell">

  <section id="endangered-gallery">
    <h2 class="gallery-heading">üåä Rare & Endangered Ocean Species</h2>
    <p class="gallery-subtitle">
      Discover some of the ocean‚Äôs most threatened animals. Each card shows real conservation
      status and an AI‚Äëstyle ‚Äúvoice‚Äù explaining what that species needs from us. <span>Hover</span> to
      let them ‚Äúspeak,‚Äù or ask the AI panel on the right for a deeper explanation.
    </p>

    <div class="gallery-toolbar">
      <div class="legend-chips">
        <div class="legend-chip">
          <div class="legend-dot cr"></div><span>CR ‚Äì Critically Endangered</span>
        </div>
        <div class="legend-chip">
          <div class="legend-dot en"></div><span>EN ‚Äì Endangered</span>
        </div>
        <div class="legend-chip">
          <div class="legend-dot vu"></div><span>VU ‚Äì Vulnerable</span>
        </div>
      </div>
      <div class="view-toggle">
        View mode:
        <button class="active" type="button">Cards</button>
        <button type="button" disabled title="Map view coming soon">Map (soon)</button>
      </div>
    </div>

    <div class="gallery-main">
      <div class="gallery-grid">
        <!-- species cards injected by JS -->
      </div>

      <aside class="ai-panel">
        <div class="ai-panel-header">
          <div class="ai-title-row">
            <div class="ai-orb"></div>
            <div>
              <div class="ai-title">Ocean Species AI Explainer</div>
              <div class="ai-subtitle">
                Click <strong>‚ÄúAsk the AI about this species‚Äù</strong> on any card to get a tailored explanation here.
              </div>
            </div>
          </div>
          <div class="ai-badge">
            <span>ü§ñ</span> Conceptual AI ¬∑ Offline demo
          </div>
        </div>

        <div id="aiDisplay" class="ai-display">
          <div class="ai-placeholder">
            Choose a species on the left and tap<br>
            <strong>‚ÄúAsk the AI about this species‚Äù</strong><br>
            to see a smart, student‚Äëfriendly explanation here.
          </div>
        </div>

        <div class="ai-actions-row">
          <div class="ai-small-note">
            Responses are generated from curated knowledge<br>about endangered marine life.
          </div>
          <button class="ai-refresh-btn" type="button" id="aiRandomBtn">
            <span>üé≤</span> Surprise me
          </button>
        </div>
      </aside>
    </div>
  </section>

</div>

<script>
  // === DATA: Endangered & Threatened Ocean Species ===
  const endangeredSpecies = [
    {
      id:"vaquita",
      commonName:"Vaquita",
      sciName:"Phocoena sinus",
      status:"CR",
      img:"https://upload.wikimedia.org/wikipedia/commons/5/5d/Vaquita5_Olson_NOAA.jpg",
      count:"< 30",
      bio:"The vaquita is the world‚Äôs rarest marine mammal, found only in the northern Gulf of California. Scientists believe fewer than 30 remain.",
      threats:["Illegal gillnet fishing","Bycatch in totoaba nets","Habitat degradation"],
      aiTip:"If I could speak, I‚Äôd ask for a net‚Äëfree sanctuary in my last remaining home in the Gulf of California.",
      region:"Northern Gulf of California, Mexico"
    },
    {
      id:"north_atlantic_right_whale",
      commonName:"North Atlantic Right Whale",
      sciName:"Eubalaena glacialis",
      status:"CR",
      img:"https://upload.wikimedia.org/wikipedia/commons/b/b1/North_Atlantic_Right_Whale_with_calve.jpg",
      count:"~340",
      bio:"Once heavily hunted, this whale now struggles mainly with ship strikes and fishing gear entanglement along busy shipping corridors.",
      threats:["Ship strikes","Fishing rope entanglement","Noise pollution"],
      aiTip:"Slower ships, quieter seas, and safer fishing gear would give my calves a real chance to grow up.",
      region:"Western North Atlantic Ocean"
    },
    {
      id:"hawksbill_turtle",
      commonName:"Hawksbill Turtle",
      sciName:"Eretmochelys imbricata",
      status:"CR",
      img:"https://upload.wikimedia.org/wikipedia/commons/b/b9/Hawksbill_Turtle_-_Eretmochelys_imbricata.jpg",
      count:"~8,000 nesting females",
      bio:"A reef‚Äëdwelling turtle prized for its beautiful shell. Habitat loss, egg collection, and plastic pollution have driven severe declines.",
      threats:["Illegal shell trade","Egg harvesting","Marine plastics","Coral reef loss"],
      aiTip:"Healthy coral reefs and plastic‚Äëfree coasts are my best hope. Every piece of plastic you skip truly helps.",
      region:"Tropical coral reefs worldwide"
    },
    {
      id:"giant_manta_ray",
      commonName:"Giant Manta Ray",
      sciName:"Mobula birostris",
      status:"EN",
      img:"https://upload.wikimedia.org/wikipedia/commons/c/c6/Manta_birostris-Thailand1.jpg",
      count:"Declining",
      bio:"With a wingspan up to 7 meters, giant mantas are filter‚Äëfeeding giants that migrate across ocean basins and often gather at cleaning stations.",
      threats:["Overfishing for gill plates","Bycatch in nets","Pollution and microplastics"],
      aiTip:"Protecting key aggregation sites and regulating trade in my gill plates lets me keep ‚Äòflying‚Äô through the open ocean.",
      region:"Tropical & subtropical oceans worldwide"
    },
    {
      id:"hawaiian_monk_seal",
      commonName:"Hawaiian Monk Seal",
      sciName:"Neomonachus schauinslandi",
      status:"EN",
      img:"https://upload.wikimedia.org/wikipedia/commons/0/0b/Hawaiian_Monk_Seal_Molokai.JPG",
      count:"~1,500",
      bio:"One of the world‚Äôs only tropical seals, found mostly around the Northwestern Hawaiian Islands. Threatened by entanglement, disease, and habitat loss.",
      threats:["Fishing gear entanglement","Disease","Loss of pupping beaches"],
      aiTip:"Clean beaches, careful fisheries, and disease monitoring can keep pups safe along our remote island shores.",
      region:"Hawaiian Archipelago"
    },
    {
      id:"dugong",
      commonName:"Dugong",
      sciName:"Dugong dugon",
      status:"VU",
      img:"https://upload.wikimedia.org/wikipedia/commons/0/0c/Dugong_m0011160.jpg",
      count:"Patchy & declining",
      bio:"A gentle seagrass‚Äëgrazing relative of manatees. Dugongs depend on shallow, healthy seagrass meadows for food and shelter.",
      threats:["Boat strikes","Seagrass loss","Entanglement","Hunting in some regions"],
      aiTip:"Protecting quiet, clear seagrass meadows gives me‚Äîand many fish and invertebrates‚Äîa living underwater garden.",
      region:"Coastal Indian & western Pacific Oceans"
    }
  ];

  // === AI-style explanations per species (static for now; later you can call Perplexity) ===
  const aiExplain = {
    vaquita: {
      title:"Why is the Vaquita so close to extinction?",
      metrics:[
        {main:"< 30",label:"Estimated individuals left"},
        {main:"1",label:"Small home range"},
        {main:"Gillnets",label:"Top driver of decline"}
      ],
      body:[
        "The vaquita lives in only one small region of the ocean: the northern Gulf of California. That limited range makes it extremely vulnerable to any local threat.",
        "For many years, illegal fishing for another fish (the totoaba) used gillnets that the vaquita cannot detect. These nearly invisible nets entangle and drown the porpoises.",
        "Conservation efforts now focus on enforcing gillnet‚Äëfree zones and finding alternative livelihoods for local fishers. Each net removed from the water could mean one more vaquita survives."
      ],
      footer:"This explanation is based on conservation reports for the vaquita, simplified for students."
    },
    north_atlantic_right_whale:{
      title:"What is pushing the North Atlantic right whale to the edge?",
      metrics:[
        {main:"~340",label:"Individuals left"},
        {main:"Ship strikes",label:"Major cause of death"},
        {main:"Entanglement",label:"Chronic stress & injury"}
      ],
      body:[
        "Right whales migrate through some of the busiest shipping lanes in the North Atlantic. Collisions with large vessels can be fatal, especially for calves.",
        "Fishing ropes and lines can wrap around whales, cutting into skin and slowing them down. Over time, this makes it harder for them to feed, heal, and reproduce.",
        "Solutions include speed restrictions, route changes, and new rope‚Äëfree fishing technologies designed to protect both whales and fishers‚Äô livelihoods."
      ],
      footer:"Data adapted from whale research organizations and IUCN summaries."
    },
    hawksbill_turtle:{
      title:"Why are Hawksbill turtles critically endangered?",
      metrics:[
        {main:"CR",label:"IUCN status"},
        {main:"Tortoiseshell",label:"Historic trade"},
        {main:"Coral reefs",label:"Key habitat at risk"}
      ],
      body:[
        "Hawksbills were hunted for centuries for their beautifully patterned shells used in jewelry and ornaments (often called ‚Äòtortoiseshell‚Äô). Although international trade is now banned, illegal trade still occurs.",
        "They nest on tropical beaches and feed around coral reefs‚Äîboth of which are threatened by coastal development, climate change, and pollution.",
        "Reducing demand for wildlife products, protecting nesting beaches, and safeguarding coral reefs all help Hawskbill populations recover."
      ],
      footer:"Explanation inspired by sea turtle conservation groups and global assessments."
    },
    giant_manta_ray:{
      title:"What makes Giant manta rays vulnerable?",
      metrics:[
        {main:"7 m",label:"Wingspan up to"},
        {main:"Slow",label:"Reproduction rate"},
        {main:"Gill plate trade",label:"Key threat"}
      ],
      body:[
        "Giant mantas produce very few young, typically a single pup after a long gestation. That means populations recover slowly from any losses.",
        "Targeted fishing and bycatch have increased due to demand for manta gill plates in some traditional medicines and markets.",
        "Marine protected areas, ecotourism, and strict regulations on targeted fishing give these ‚Äòflying‚Äô rays a chance to rebuild their numbers."
      ],
      footer:"Summarized from scientific literature on manta ray life history and fisheries."
    },
    hawaiian_monk_seal:{
      title:"Why is the Hawaiian monk seal endangered?",
      metrics:[
        {main:"~1,500",label:"Remaining seals"},
        {main:"Beaches",label:"Crucial for pupping"},
        {main:"Entanglement",label:"Frequent hazard"}
      ],
      body:[
        "Hawaiian monk seals rely on quiet, undisturbed beaches to give birth and raise pups. Coastal development and disturbance can reduce the quality of these pupping sites.",
        "Fishing nets and marine debris can trap curious seals, leading to injury or death.",
        "Conservation programs in Hawaii combine beach protection, debris removal, and careful human‚Äëwildlife coexistence to support monk seal recovery."
      ],
      footer:"Based on NOAA and local conservation program summaries."
    },
    dugong:{
      title:"How do Dugongs tell us if seagrass meadows are healthy?",
      metrics:[
        {main:"‚ÄòSea cows‚Äô",label:"Nicknamed for grazing"},
        {main:"Seagrass",label:"Main food source"},
        {main:"Shallow coasts",label:"Most at risk"}
      ],
      body:[
        "Dugongs depend on shallow seagrass beds, which are sensitive to pollution, dredging, and climate‚Äëdriven changes.",
        "Where dugongs thrive, it often means that water quality is high and seagrass meadows are doing well‚Äîsupporting many fish, invertebrates, and coastal communities.",
        "Protecting dugongs means protecting seagrass, which also stores ‚Äòblue carbon‚Äô and helps buffer coasts from erosion."
      ],
      footer:"Drawn from seagrass and marine mammal conservation research."
    }
  };

  // === Build cards ===
  function renderEndangeredCards(){
    const grid=document.querySelector(".gallery-grid");
    grid.innerHTML="";
    endangeredSpecies.forEach(species=>{
      const card=document.createElement("article");
      card.className=`species-card status-${species.status.toLowerCase()}`;

      const statusLabel = species.status==="CR" ? "Critically Endangered" :
                          species.status==="EN" ? "Endangered" :
                          species.status==="VU" ? "Vulnerable" : species.status;

      card.innerHTML=`
        <div class="species-photo-wrap">
          <img src="${species.img}" alt="${species.commonName}" class="species-photo">
          <div class="status-badge">${statusLabel}</div>
          <div class="iucn-pill">IUCN: ${species.status}</div>
        </div>
        <div class="species-body">
          <div class="common-name">
            <span>${species.commonName}</span>
          </div>
          <div class="sci-name">${species.sciName}</div>
          <div class="pop-count">Estimated remaining: <strong>${species.count}</strong></div>
          <div class="bio-text">${species.bio}</div>
          <ul class="threats">
            <li><b>Key threats:</b> ${species.threats.join(", ")}</li>
          </ul>
          <div class="region-highlight"><span>üìç</span>${species.region}</div>
          <div class="ai-speech"><span>‚Äú</span>${species.aiTip}<span>‚Äù</span></div>
          <div class="card-footer-row">
            <span>Tap to let this species ‚Äòspeak‚Äô louder.</span>
            <span class="ask-ai-link" data-species="${species.id}">
              ü§ñ Ask the AI about this species
            </span>
          </div>
        </div>
      `;

      card.addEventListener("mouseenter",()=>card.classList.add("speak"));
      card.addEventListener("mouseleave",()=>card.classList.remove("speak"));

      grid.appendChild(card);
    });
  }

  // === AI Panel logic (offline demo; later connect to Perplexity backend) ===
  function showAiLoading(){
    const box=document.getElementById("aiDisplay");
    box.innerHTML=`
      <div class="ai-loading">
        <div class="ai-loading-spinner"></div>
        <div class="ai-loading-label">
          Analyzing conservation data and recent science for this species‚Ä¶
        </div>
      </div>
    `;
  }

  function showAiAnswerBlock(speciesId){
    const cfg = aiExplain[speciesId];
    const species = endangeredSpecies.find(s=>s.id===speciesId);
    if(!cfg || !species) return;
    const box=document.getElementById("aiDisplay");
    const metricsHTML = (cfg.metrics||[]).map(m=>`
      <div class="ai-metric-card">
        <div class="ai-metric-main">${m.main}</div>
        <div class="ai-metric-label">${m.label}</div>
      </div>
    `).join("");

    const bodyHTML = (cfg.body||[]).map(p=>`<p class="ai-body-text">${p}</p>`).join("");

    box.innerHTML=`
      <div class="ai-answer-block">
        <div class="ai-answer-title">
          <span>ü§ñ</span>
          <span>${cfg.title}</span>
        </div>
        <div class="ai-metrics">${metricsHTML}</div>
        ${bodyHTML}
        <div class="ai-footer-text">
          You‚Äôre exploring: <strong>${species.commonName}</strong> (<em>${species.sciName}</em>).
          ${cfg.footer}
        </div>
      </div>
    `;
  }

  function attachAiHandlers(){
    document.querySelectorAll(".ask-ai-link").forEach(link=>{
      link.addEventListener("click",()=>{
        const speciesId = link.getAttribute("data-species");
        showAiLoading();
        // simulate AI latency
        setTimeout(()=>showAiAnswerBlock(speciesId),900);
      });
    });

    const randomBtn=document.getElementById("aiRandomBtn");
    if(randomBtn){
      randomBtn.addEventListener("click",()=>{
        const ids = Object.keys(aiExplain);
        const pick = ids[Math.floor(Math.random()*ids.length)];
        showAiLoading();
        setTimeout(()=>showAiAnswerBlock(pick),900);
      });
    }
  }

  document.addEventListener("DOMContentLoaded",()=>{
    renderEndangeredCards();
    attachAiHandlers();
  });
</script>

</body>
</html>
